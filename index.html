<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>प्रमाण पत्र जनरेटर</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&display=swap" rel="stylesheet">
<style>
body { font-family: "Noto Sans Devanagari", sans-serif; text-align: center; background: #f8f8f8; }
.input-section { margin: 20px; }
.certificate { position: relative; width: 800px; height: 600px; margin: 20px auto; display: none; border: 4px solid #d4af37; background: url("https://egovlabksj.github.io/crt-generator/certificate-bg1.png") no-repeat center center; background-size: cover; }
.header-text { position: absolute; top: 150px; width: 100%; text-align: center; font-size: 20px; font-weight: bold; }
.main-title { position: absolute; top: 240px; width: 100%; text-align: center; font-size: 30px; font-weight: bold; color: #0b3d91; }
.name-line { position: absolute; top: 280px; width: 100%; text-align: center; font-size: 22px; }
.footer-text { position: absolute; bottom: 120px; width: 100%; text-align: center; font-size: 18px; }
.ref-no { position: absolute; bottom: 20px; left: 30px; font-size: 14px; color: #000; font-style: italic; }
button { margin-top: 10px; padding: 10px 20px; font-size: 16px; background: #0b3d91; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
input { padding: 8px; font-size: 16px; width: 250px; margin: 5px; }
#qrCode { position: absolute; bottom: 20px; right: 20px; width: 120px; height: 120px; border: 1px solid #ccc; background: #fff; padding: 5px; }
</style>
</head>
<body>

<div class="input-section">
<h2>ऑटोमेटिक प्रमाण पत्र जनरेटर</h2>
<input type="text" id="nameInput" placeholder="अपना नाम दर्ज करें">
<input type="text" id="mobileInput" placeholder="मोबाइल नंबर दर्ज करें">
<input type="email" id="emailInput" placeholder="ईमेल दर्ज करें">
<br>
<button id="generateBtn">प्रमाण पत्र दिखाएं</button>
<button id="downloadBtn">PNG डाउनलोड करें</button>
</div>

<div id="certificate" class="certificate">
<div class="header-text">परम राज्य : विकसित यूपी@2047<br>संकल्प से समृद्धि तक</div>
<div class="main-title">सहभागिता प्रमाण पत्र</div>
<div class="name-line">
यह प्रमाण पत्र <span id="nameText">____</span><br>
नगर निकाय: <strong>कासगंज</strong>, जनपद: <strong>कासगंज</strong>
</div>
<div class="footer-text">
को विकसित यूपी@2047 के विजन डॉक्यूमेंट तैयार किए जाने में आपके मूल्यवान सुझावों हेतु<br>
प्रदान किया जाता है। हम आपके विचारों और समर्पण की सराहना करते हैं।
</div>
<div class="ref-no" id="refNoText"></div>
<img id="qrCode" alt="QR Code">
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyXGMzsFBWYuxy84XYa8CrjHGgrMElyEIW93YUZHsn4mOjDtFl--0UuR5r6CdqJe8la/exec"; // Replace with your Apps Script Web App URL

document.getElementById("generateBtn").addEventListener("click", async function() {
  const name = document.getElementById("nameInput").value.trim();
  const mobile = document.getElementById("mobileInput").value.trim();
  const email = document.getElementById("emailInput").value.trim();

  if(!name || !mobile || !email) { alert("कृपया सभी विवरण भरें।"); return; }

  const timestamp = new Date().toISOString().replace(/[-:.TZ]/g,"");
  const referenceNo = `${timestamp}/Ksj/CRT`;
  const verifyLink = `https://EgovlabKsj.github.io/new-crt/verify.html?ref=${encodeURIComponent(referenceNo)}`;

  // Generate QR as Base64
  const qrBase64 = await QRCode.toDataURL(verifyLink, { width: 150, margin: 1 });

  // Show certificate
  document.getElementById("nameText").textContent = name;
  document.getElementById("refNoText").textContent = "Reference No.: " + referenceNo;
  document.getElementById("qrCode").src = qrBase64;
  document.getElementById("certificate").style.display = "block";
  window.scrollTo(0, document.getElementById("certificate").offsetTop);

  // Send to Apps Script
  try {
    const res = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ name, mobile, email, qrBase64 }),
      headers: { "Content-Type": "application/json" }
    });
    const json = await res.json();
    console.log("Saved to Sheet:", json);
  } catch(err) {
    console.error("Error saving to Sheet:", err);
  }
});

document.getElementById("downloadBtn").addEventListener("click", async function() {
  const cert = document.getElementById("certificate");
  const canvas = await html2canvas(cert, { scale: 4, useCORS: true });
  const link = document.createElement("a");
  link.download = "certificate.png";
  link.href = canvas.toDataURL("image/png",1.0);
  link.click();
});
</script>
</body>
</html>
